<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Presentation App</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
    integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
    crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;600&display=swap" rel="stylesheet">

  <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">

  <style>
    body,
    html {
      font-family: 'Figtree', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .presentation-zone {
      background-color: white;
      width: 100vw;
      height: 93vh;
      /* adjusted to make room for taller nav */
      overflow: hidden;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
      z-index: 1;
    }

    .bottom-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #C1D8FF;
      border-top: 1px solid #ccc;
      width: 100%;
      height: 7vh;
      /* increased height to prevent crowding */
      padding: 0 20px;
      box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
      z-index: 10;
      position: fixed;
      bottom: 0;
    }

    .nav-left,
    .nav-center,
    .nav-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-left,
    .nav-right {
      flex: 1;
    }

    .nav-center {
      flex: 2;
      justify-content: center;
      flex-wrap: nowrap;
      overflow-x: auto;
      overflow: visible;
    }

    .nav-center::-webkit-scrollbar {
      display: none;
    }

    /*Button styling from https://codepen.io/t_afif/pen/abKyJNJ*/
    button {
      --c: #229091;
      /* default color */
      font-family: inherit;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      white-space: nowrap;

      box-shadow: 0 0 0 .1em inset var(--c);
      --_g: linear-gradient(var(--c) 0 0) no-repeat;
      background:
        var(--_g) calc(var(--_p, 0%) - 100%) 0%,
        var(--_g) calc(200% - var(--_p, 0%)) 0%,
        var(--_g) calc(var(--_p, 0%) - 100%) 100%,
        var(--_g) calc(200% - var(--_p, 0%)) 100%;
      background-size: 50.5% calc(var(--_p, 0%)/2 + .5%);
      outline-offset: .1em;
      transition: background-size .4s, background-position 0s .4s;
    }

    button:hover {
      --_p: 100%;
      transition: background-position .4s, background-size 0s;
    }

    button:active {
      box-shadow: 0 0 2em inset #0009;
      background-color: var(--c);
      color: #fff;
    }

    #slideNumberDisplay {
      font-weight: bold;
      font-size: 14px;
      color: #333;
      text-align: center;
      white-space: nowrap;
    }

    input[type="file"] {
      font-size: 13px;
    }

    /* Dropdown toggle button */
    #dropdownMenuButton {
      background-color: #5eb681;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      width: 40px;
      height: 40px;
      padding: 0;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Dropdown menu container */
    .dropdown-menu {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 10px;
      min-width: 180px;
      background-color: white;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      position: absolute;
      bottom: 50px;
      right: 0;
      z-index: 1000;
      border: 1px solid #ddd;
    }

    /* Show menu class */
    .dropdown-menu.show {
      display: flex !important;
    }

    /* Buttons inside the dropdown */
    .dropdown-menu button {
      width: 100%;
      text-align: center;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: bold;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.1s ease;
      box-shadow: 0 0 0 0.1em inset var(--c, #ccc);
      --_g: linear-gradient(to right, var(--c, #ccc), var(--c, #ccc)) no-repeat;

      background:
        var(--_g) calc(var(--_p, 0%) - 100%) 0%,
        var(--_g) calc(200% - var(--_p, 0%)) 0%,
        var(--_g) calc(var(--_p, 0%) - 100%) 100%,
        var(--_g) calc(200% - var(--_p, 0%)) 100%;
      background-size: 50.5% calc(var(--_p, 0%)/2 + 0.5%);
      transition: background-size 0.4s, background-position 0s 0.4s;
    }

    /* Hover animation */
    .dropdown-menu button:hover {
      --_p: 100%;
      background-color: #f7f7f7;
      transform: scale(1.02);
    }

    .dropdown-menu button:active {
      background-color: var(--c, #999);
      color: white;
      box-shadow: 0 0 1em inset #0005;
    }

    .custom-file-btn {
      --c: #a29bfe;
      display: inline-block;
      font-size: 14px;
      font-weight: bold;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;

      box-shadow: 0 0 0 .1em inset var(--c);
      --_g: linear-gradient(to right, var(--c), var(--c)) no-repeat;
      background:
        var(--_g) calc(var(--_p, 0%) - 100%) 0%,
        var(--_g) calc(200% - var(--_p, 0%)) 0%,
        var(--_g) calc(var(--_p, 0%) - 100%) 100%,
        var(--_g) calc(200% - var(--_p, 0%)) 100%;
      background-size: 50.5% calc(var(--_p, 0%)/2 + .5%);
      transition: background-size .4s, background-position 0s .4s;
    }

    .custom-file-btn:hover {
      --_p: 100%;
      transition: background-position .4s, background-size 0s;
    }

    .custom-file-btn:active {
      box-shadow: 0 0 2em inset #0009;
      background-color: var(--c);
      color: white;
    }

    #end-slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      visibility: hidden;
      color: white;
      font-size: 6.5em;
    }

    /*.divider {*/
    /*  color: #999;*/
    /*  margin: 0 6px;*/
    /*  font-weight: bold;*/
    /*  user-select: none;*/
    /*}*/

    #formatting-menu {
      position: absolute;
      z-index: 9999;
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      display: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }


    .textbox {
      position: relative;
      cursor: pointer;
      user-select: none;
      overflow: visible !important;
    }

    /* Enable scrolling only when editing */
    .textbox[contenteditable="true"] {
      overflow: auto !important;
    }

    .textbox::after {
      content: "Double-click to edit text";
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: #666;
      background: rgba(255, 255, 255, 0.95);
      padding: 4px 8px;
      border-radius: 4px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 9999;
    }

    .textbox:hover::after {
      opacity: 1;
    }

    .image {
      resize: both;
      overflow: auto;
      cursor: grab;
      border: 1px solid black;
      border-radius: 5px;
      background-size: cover;
      background-position: center;
    }
  </style>


</head>

<body>

  <div class="presentation-zone" id="presentation-zone">
    <div id="end-slide">
      <p>El Fin.</p>
    </div>
  </div>

  <div id="formatting-menu">
    <label>Font:
      <select id="font-select">
        <option>Arial</option>
        <option>Courier New</option>
        <option>Times New Roman</option>
        <option>Georgia</option>
        <option>Verdana</option>
      </select>
    </label><br>
    <label>Size:
      <input type="number" id="font-size-input" min="8" max="72" value="14">
    </label><br>
    <label>Color:
      <input type="color" id="color-picker" value="#000000">
    </label><br>
    <button id="apply-formatting-btn">Apply</button>
    <button id="cancel-formatting-btn">Cancel</button>
  </div>

  <div style="visibility: visible" id="bottom-nav" class="bottom-nav">
    <div class="nav-left">
      <label for="fileInput" class="custom-file-btn">üìÇ Load Deck</label>
      <input type="file" id="fileInput" accept=".json" style="display: none;">
    </div>
    <div class="nav-center">
      <button id="saveDeck">Save Deck</button>
      <!-- <button id="resizeImageButton">Resize Image</button> -->
      <!--    <select id="imageSelectDropdown"></select>-->
      <input type="file" id="imageInput" accept="image/*" style="display: none;" />

      <button id="stopButton" style="--c:#FF5722">Stop</button>
      <button id="startButton" style="--c:#4CAF50">Start</button>
      <button id="deleteSlideButton">Delete Slide</button>

      <div class="btn-group dropup">
        <button class="btn btn-light border dropdown-toggle" type="button" id="dropdownMenuButton"
          data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          +
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <button id="addTextBoxButton" style="--c:#3F51B5">üìù Add Text</button>
          <button id="addImageButton" style="--c: #55efc4;">üñºÔ∏è Add Image</button>
          <button id="addNewSlideButton" style="--c: #74b9ff;">üìÑ New Slide</button>
          <button id="addTransition" style="--c: #ffeaa7;">üé¨ Add Transition</button>

        </div>
      </div>
    </div>

    <div class="nav-right">
      <button id="moveBackButton" style="--c:#ccc;">Swap<i class="fa-solid fa-angles-left"></i></button>
      <button id="reverseButton">Last Slide<i class="fa-solid fa-angles-left"></i></button>
      <span id="slideNumberDisplay">0 of 0</span>
      <button id="advanceButton" style="--c:#1E90FF;">Next Slide<i class="fa-solid fa-angles-right"></i></button>
      <button id="moveForwardButton" style="--c:#ccc;">Swap<i class="fa-solid fa-angles-right"></i></button>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script src="output.js"></script>
  <script src="WebLayout/EditElement.js"></script>

  <script>
    const saveDeck = Module.cwrap('call_exportSlideDeckToJson', 'string', []);

    document.getElementById("fileInput").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (event) {
        const jsonStr = event.target.result;
        // I have to do this for large files to prevent stack overflow (did not know that was a real thing)
        const lengthBytes = lengthBytesUTF8(jsonStr) + 1;
        const buffer = Module._malloc(lengthBytes);
        if (!buffer) {
          alert("Failed to allocate mem.");
          return;
        }
        try {
          stringToUTF8(jsonStr, buffer, lengthBytes);
          Module.ccall("call_loadSlideDeckFromJson", null, ["number"], [buffer]);
        } catch (err) {
          alert("Failed to load deck: " + err);
        } finally {
          Module._free(buffer);
        }
      };
      reader.readAsText(file);
    });

    document.getElementById("saveDeck").addEventListener("click", function () {
      const exported = saveDeck();
      const blob = new Blob([exported], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = "slides.json";
      link.click();
    });

    // for adding images
    document.addEventListener("DOMContentLoaded", function () {
      const addImageBtn = document.getElementById("addImageButton");
      const imageInput = document.getElementById("imageInput");

      function toUTF8(str) {
        const len = Module.lengthBytesUTF8(str) + 1;
        const ptr = Module._malloc(len);
        Module.stringToUTF8(str, ptr, len);
        return ptr;
      }

      addImageBtn.addEventListener("click", () => {
        imageInput.click();
      });

      imageInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (event) {
          const dataUrl = event.target.result;

          const urlPtr = toUTF8(dataUrl);
          const altPtr = toUTF8("User Image");

          Module.ccall("call_addImage", null,
            ["number", "number", "number", "number"],
            [urlPtr, 300, 200, altPtr]
          );

          _free(urlPtr);
          _free(altPtr);
        };

        reader.readAsDataURL(file);
      });

    });
    /*
      // BELOW IS CODE FOR DELETE CONFIRMATION
      let timeout;
    
      function resetConfirmButton() {
        doubleConfirmInner.classList.remove('-translate-x-full');
      }
    
      // grab buttons for delete slide
      const doubleConfirm = document.querySelector('.double-confirm');
      const doubleConfirmInner = document.querySelector('.double-confirm-inner');
    
      // add button event listener
      doubleConfirm.addEventListener('click', (e) => {
        e.stopPropagation(); // From ChatGPT: stops clicks inside group triggering reset
    
        doubleConfirmInner.classList.add('-translate-x-full');
    
        // https://www.w3schools.com/jsref/met_win_settimeout.asp
        if(timeout) clearTimeout(timeout);
    
        timeout = setTimeout(() => {
          resetConfirmButton();
        }, 3000);
    
      });
    
      // If click elsewhere, reset confirm button
      document.addEventListener('click', (e) => {
        if (doubleConfirmInner.classList.contains('-translate-x-full')) {
          resetConfirmButton();
        }
      });
    */
  </script>

</body>

</html>